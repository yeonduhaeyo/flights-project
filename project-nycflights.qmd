---
title: "ë‰´ìš• ê³µí•­ ë°ì´í„° ë¶„ì„"
format: revealjs
theme: default
slide-level: 3
echo: false # ëª¨ë“  ì½”ë“œ ìˆ¨ê¹€
---

## 

<!-- ë¶€ì œëª©ì„¤ì • -->

::: {.middle style="text-align: center; font-size: 2em;"}
**"[American]{style="color: black;"} í•­ê³µì˜ ê³ ê³µí–‰ì§„, [JetBlue]{style="color: blue;"}ê°€ íŒë„ë¥¼ ë°”ê¾¸ë‚˜?"**
:::

## Team ì†Œê°œ

::: {style="margin-top: 30px;"}
Team name : 1ì¡°

Team member : ê¹€ë™ê· , ìœ ì°½ìš°, ì´ì˜íƒ, ì¥ìŠ¹ê·œ, í™©ì—°ì£¼
:::

## Index

::: {style="font-size: 1.0em; line-height: 2;"}
1.  í”„ë¡œì íŠ¸ ë°°ê²½ ë° ê²°ê³¼ ìš”ì•½\
2.  ë°ì´í„° ì„¤ëª…\
3.  ë°ì´í„° ì „ì²˜ë¦¬\
4.  ë°ì´í„° ë¶„ì„\
5.  ìµœì¢… ê²°ê³¼ ë° ì¸ì‚¬ì´íŠ¸
:::

## í”„ë¡œì íŠ¸ ë°°ê²½ ë° ê²°ê³¼ ìš”ì•½

1.  2013ë…„ JetBlueì˜ í˜„ì¬ ìœ„ì¹˜
2.  2013ë…„ í˜„ì¬ í™˜ê²½
3.  ì£¼ìš” ê²°ê³¼ ê°„ëµ ì†Œê°œ

### **JetBlueì˜ í˜„ì¬ ìœ„ì¹˜**

-   ë¯¸êµ­ í•­ê³µì‚¬ ì „ì²´ ì ìœ ìœ¨ì€ **ì €ê°€ í•­ê³µì‚¬ ê¸°ì¤€ 2ë“±**

-   ë‰´ìš•ì˜ ì´ í•­ê³µí¸ ì ìœ ìœ¨ **2ë“±**

::: {layout-ncol="2"}
```{python}

import pandas as pd
import numpy as np
import nycflights13 as flights  # flights13 ë°ì´í„° íŒ¨í‚¤ì§€
import re  # ì •ê·œ í‘œí˜„ì‹(Regular Expression)

import seaborn as sns  # ì‹œê°í™”ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€
import matplotlib.pyplot as plt

# í°íŠ¸ì„¤ì •
plt.rc('font', family='Malgun Gothic')
plt.rc('axes', unicode_minus=False)

df_flights = flights.flights.copy()  # flights í…Œì´ë¸” ì›ë³¸ë°ì´í„°
df_planes = flights.planes.copy()  # planes í…Œì´ë¸” ì›ë³¸ë°ì´í„°
df_airports = flights.airports.copy()

df_fill = pd.read_csv("./data/df_fill.csv")
df_drop = pd.read_csv("./data/df_drop.csv")
```
```{python}
#| fig-align: center

airlines_display = [
    "United Airlines (UA)",
    "Delta Air Lines (DL)",
    "American Airlines (AA)",   # AA
    "Southwest Airlines (WN)",  # WN ë¨¼ì €!
    "US Airways (US)",          # US ë’¤ë¡œ!
    "JetBlue Airways (B6)",
    "Alaska Airlines (AS)",
    "ExpressJet (EV)",
    "Others (Others)"
]

rpm_values = [
    21.21,    # UA
    20.52,    # DL
    15.3,     # AA
    10.73,    # WN
    7.9,      # US
    4.26,     # B6
    3.11,     # AS
    2.01,     # EV
    15.02     # Others
]

carrier_codes_display = {
    "United Airlines (UA)": "UA",
    "Delta Air Lines (DL)": "DL",
    "American Airlines (AA)": "AA",
    "Southwest Airlines (WN)": "WN",
    "US Airways (US)": "US",
    "JetBlue Airways (B6)": "B6",
    "Alaska Airlines (AS)": "AS",
    "ExpressJet (EV)": "EV",
    "Others (Others)": "Others"
}

custom_color_map = {
    'UA': '#a5d5c5',
    'DL': '#f08080',
    'AA': '#6fa9d2',
    'US': '#c8e685',
    'B6': '#000f5d',
    'EV': "#d1cce6",
    'WN': '#ccccff',
    'AS': '#8fbc8f',
    'Others': '#d3d3d3'
}

lst = ["JetBlue Airways (B6)", "Southwest Airlines (WN)"]
colors_custom = [custom_color_map.get(carrier_codes_display[label], '#d3d3d3') for label in airlines_display]
explode = [0.0 if not label in lst else 0.1 for label in airlines_display]

fig, ax = plt.subplots(figsize=(12, 8))
wedges, texts, autotexts = ax.pie(
    rpm_values,
    labels=airlines_display,
    autopct='%1.1f%%',
    startangle=140,
    colors=colors_custom,
    explode=explode,
    textprops={'fontsize': 11}
)

for i, label in enumerate(airlines_display):
    texts[i].set_fontweight('bold')
    texts[i].set_fontsize(16)
    autotexts[i].set_fontweight('bold')
    if "JetBlue" in label:
        autotexts[i].set_color("white")
        x, y = texts[i].get_position()
        texts[i].set_position((x, y - 0.07))
    if "ExpressJet (EV)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x - 0.08, y + 0.10))   
    if "Alaska Airlines (AS)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x, y + 0.06)) 

# í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì¡°ì •
for i, wedge in enumerate(wedges):
    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    r = 0.70
    if airlines_display[i] == "ExpressJet (EV)":
        r = 0.87
    elif airlines_display[i] == "Alaska Airlines (AS)":
        r = 0.82
    x = r * np.cos(angle_rad)
    y = r * np.sin(angle_rad)
    autotexts[i].set_position((x, y))
    if airlines_display[i] not in ["ExpressJet (EV)", "Alaska Airlines (AS)"]:
        autotexts[i].set_fontsize(20)
    else:
        autotexts[i].set_fontsize(11)

def draw_arrow_label_to_wedge_edge_middle(ax, text_obj, wedge, arrow_color='gray', r=1.0, y_offset=-0.04):
    renderer = fig.canvas.get_renderer()
    bbox = text_obj.get_window_extent(renderer=renderer)
    x0_fig = (bbox.x0 + bbox.x1) / 2.03
    y0_fig = (bbox.y0 + bbox.y1) / 2
    inv = ax.transData.inverted()
    x0_data, y0_data = inv.transform((x0_fig, y0_fig))

    arrow_start_x = x0_data
    arrow_start_y = y0_data + y_offset

    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    x_wedge_edge = r * np.cos(angle_rad)
    y_wedge_edge = r * np.sin(angle_rad)

    ax.annotate(
        '', xy=(x_wedge_edge, y_wedge_edge), xytext=(arrow_start_x, arrow_start_y),
        arrowprops=dict(facecolor=arrow_color, arrowstyle='->', lw=2),
        annotation_clip=False
    )

fig.canvas.draw()

ev_idx = airlines_display.index("ExpressJet (EV)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[ev_idx], wedges[ev_idx], r=1.0, y_offset=-0.04)
as_idx = airlines_display.index("Alaska Airlines (AS)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[as_idx], wedges[as_idx], r=1.0, y_offset=-0.04)

plt.title("2013ë…„ ë¯¸êµ­ í•­ê³µì‚¬ RPM ì ìœ ìœ¨", fontsize=30, pad=60, fontweight='bold')
plt.axis('equal')
plt.tight_layout()
plt.show()
```

```{python}
# ë°ì´í„° ë¡œë“œ
df = pd.read_csv("./data/df_fill.csv")

# ğŸ¯ 1. ì „ì²´ í•­ê³µì‚¬ ì ìœ ìœ¨ ë¶„ì„ (JetBlue ìƒ‰ìƒ + í¼ì„¼íŠ¸ ê°•ì¡°)

carrier_counts = df['carrier'].value_counts()
top8_carriers = carrier_counts.head(8)
others_count = carrier_counts.iloc[8:].sum()

plot_labels = list(top8_carriers.index) + ['Others']
plot_data = list(top8_carriers.values) + [others_count]

# âœ… JetBlue ì „ìš© ìƒ‰ìƒ (#000f5d) ì ìš©
jetblue_color = '#000f5d'
default_colors = plt.cm.Set3(range(len(plot_labels)))
colors = [jetblue_color if label == 'B6' else default for label, default in zip(plot_labels, default_colors)]

explode = [0.1 if label == 'B6' else 0 for label in plot_labels]

# âœ… ì‹œê°í™”
fig, ax = plt.subplots(figsize=(12, 8))
wedges, texts, autotexts = ax.pie(plot_data,
                                  labels=plot_labels,
                                  autopct='%1.1f%%',
                                  colors=colors,
                                  explode=explode,
                                  startangle=90,
                                  textprops={'fontsize': 18, 'fontweight': 'bold'})

# ğŸ‘‰ JetBlue í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ë§Œ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½
for label, autotext in zip(plot_labels, autotexts):
    autotext.set_color('white' if label == 'B6' else 'black')

# ë¼ë²¨ í…ìŠ¤íŠ¸ ê¾¸ë¯¸ê¸°
for text in texts:
    text.set_fontsize(20)
    text.set_fontweight('bold')

# í…Œë‘ë¦¬ ì„¤ì •
for wedge, label in zip(wedges, plot_labels):
    wedge.set_linewidth(4 if label == 'B6' else 0.5)
    wedge.set_edgecolor('red' if label == 'B6' else 'white')

plt.title('ë‰´ìš• ê³µí•­ì˜ í•­ê³µì‚¬ë³„ ì ìœ ìœ¨', fontsize=30, fontweight='bold')

# ë²”ë¡€ ìƒì„±
legend_labels = [f'{label}(JetBlue): {count:,}í¸' if label == 'B6' else f'{label}: {count:,}í¸'
                 for label, count in zip(plot_labels, plot_data)]

plt.legend(wedges, legend_labels,
           title="í•­ê³µí¸ ìˆ˜", title_fontsize=16,
           fontsize=16, loc="center left",
           bbox_to_anchor=(1, 0, 0.5, 1))
plt.tight_layout()
plt.show()
```
:::

###  {.center}

-   JetBlueì˜ ì£¼ìš” í—ˆë¸Œ ê³µí•­ìœ¼ë¡œ ë‰´ìš•ì˜ JFK ê³µí•­ì„ ì‚¬ìš©

::: {layout-ncol="2"}
```{python}
#| fig-align: center
# í•„ìš”í•œ ë°ì´í„° ì¬ì •ì˜
b6_flights = df[df['carrier'] == 'B6']
b6_origin_counts = b6_flights['origin'].value_counts()

jfk_count = b6_origin_counts.get('JFK', 0)
other_airports_count = len(b6_flights) - jfk_count
b6_route_data = [jfk_count, other_airports_count]
b6_route_labels = ['JFK', 'Other Airports']
b6_route_colors = ['#000f5d', 'lightgray']
b6_route_explode = [0.1, 0]

# íŒŒì´ì°¨íŠ¸ ìƒì„±
fig, ax = plt.subplots(figsize=(12, 8))
wedges, texts, autotexts = ax.pie(b6_route_data,
                                  labels=b6_route_labels,
                                  autopct='%1.1f%%',
                                  colors=b6_route_colors,
                                  explode=b6_route_explode,
                                  startangle=90,
                                  textprops={'fontsize': 24, 'fontweight': 'bold'})

# ë¼ë²¨ í…ìŠ¤íŠ¸ í°íŠ¸ ì„¤ì •
for text in texts:
    text.set_fontsize(24)
    text.set_fontweight('bold')

# í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸: JFKë§Œ í°ìƒ‰ìœ¼ë¡œ
for label, autotext in zip(b6_route_labels, autotexts):
    if label == 'JFK':
        autotext.set_color('white')
    autotext.set_fontsize(18)
    autotext.set_fontweight('bold')

# ì›¨ì§€ í…Œë‘ë¦¬ ì„¤ì •
for wedge, label in zip(wedges, b6_route_labels):
    if label == 'JFK':
        wedge.set_linewidth(4)
        wedge.set_edgecolor('red')
    else:
        wedge.set_linewidth(0.5)
        wedge.set_edgecolor('white')

# ì œëª© ë° ë²”ë¡€
plt.title('JetBlue(B6) ë‚´ JFK ì¶œë°œë…¸ì„  ë¹„ì¤‘', fontsize=30, fontweight='bold')

b6_route_legend_labels = [
    f'JFK: {jfk_count:,}í¸' if label == 'JFK' else f'{label}: {count:,}í¸'
    for label, count in zip(b6_route_labels, b6_route_data)
]

plt.legend(wedges, b6_route_legend_labels,
           title="JetBlue ì¶œë°œê³µí•­ë³„ í•­ê³µí¸ ìˆ˜",
           title_fontsize=16,
           fontsize=18,
           loc="center left",
           bbox_to_anchor=(1, 0, 0.5, 1))

plt.tight_layout()
plt.show()
```

```{python}
#| fig-align: center

# âœ… JFK ì¶œë°œ í•­ê³µí¸ í•„í„°ë§
jfk_flights = df[df['origin'] == 'JFK']
carrier_counts = jfk_flights['carrier'].value_counts()

# âœ… ìƒìœ„ 6ê°œ í•­ê³µì‚¬ë§Œ ê°œë³„ í‘œì‹œ
top6_labels = carrier_counts.head(6).index.tolist()
top6_values = carrier_counts.head(6).values.tolist()

# âœ… Others í•­ê³µí¸ ìˆ˜ ê³„ì‚°
others_value = carrier_counts.iloc[6:].sum()

# âœ… ìµœì¢… ë°ì´í„° ì •ì˜
jfk_labels = top6_labels + ['Others']
jfk_data = top6_values + [others_value]
jfk_explode = [0.1 if label == 'B6' else 0 for label in jfk_labels]

# âœ… í•­ê³µì‚¬ ì½”ë“œ â†’ í’€ë„¤ì„ ë§¤í•‘
carrier_fullnames = {
    'B6': 'JetBlue Airways',
    'DL': 'Delta Air Lines',
    '9E': 'Endeavor Air',
    'AA': 'American Airlines',
    'MQ': 'Envoy Air',
    'UA': 'United Airlines',
    'Others': 'Others'
}
jfk_labels_full = [carrier_fullnames.get(label, label) for label in jfk_labels]

# âœ… ìƒ‰ìƒ ì •ì˜ (ìƒìœ„ 6ê°œ + Others)
refined_carrier_color_map = {
    'B6': '#000f5d',
    'DL': '#f08080',
    '9E': '#fbb4d8',
    'AA': '#6fa9d2',
    'MQ': '#ffcc66',
    'UA': '#a5d5c5',
    'Others': '#d3d3d3'
}
jfk_colors_refined = [refined_carrier_color_map.get(label, 'gray') for label in jfk_labels]

# âœ… íŒŒì´ì°¨íŠ¸ ì‹œê°í™”
fig, ax = plt.subplots(figsize=(12, 8))
wedges, texts, autotexts = ax.pie(
    jfk_data,
    labels=jfk_labels_full,  # â† í’€ë„¤ì„ ë¼ë²¨ ì‚¬ìš©
    autopct='%1.1f%%',
    colors=jfk_colors_refined,
    explode=jfk_explode,
    startangle=90,
    textprops={'fontsize': 24, 'fontweight': 'bold'}
)

# âœ… í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼
for text in texts:
    text.set_fontsize(24)
    text.set_fontweight('bold')

for label_code, autotext in zip(jfk_labels, autotexts):
    autotext.set_color('white' if label_code == 'B6' else 'black')

for wedge, label_code in zip(wedges, jfk_labels):
    wedge.set_linewidth(4 if label_code == 'B6' else 0.5)
    wedge.set_edgecolor('red' if label_code == 'B6' else 'white')

# âœ… ë²”ë¡€ ì •ì˜ (í’€ë„¤ì„ ê¸°ì¤€ + JetBlue ê°•ì¡°)
legend_labels = [
    f'{carrier_fullnames[label]} (JetBlue): {count:,}í¸' if label == 'B6' 
    else f'{carrier_fullnames[label]}: {count:,}í¸'
    for label, count in zip(jfk_labels, jfk_data)
]

# plt.legend(wedges, legend_labels,
#            title="JFK ì¶œë°œ í•­ê³µí¸ ìˆ˜",
#            title_fontsize=20,
#            fontsize=14,
#            loc="center",                         # ì¤‘ì•™ ì •ë ¬
#            bbox_to_anchor=(1.02, 0.5))           # ì˜¤ë¥¸ìª½ ë°”ê¹¥, ì¤‘ê°„ ìœ„ì¹˜


plt.title('JFK ê³µí•­ì˜ í•­ê³µì‚¬ë³„ ì ìœ ìœ¨ (Top 6 + Others)', fontsize=30, fontweight='bold')
plt.tight_layout()
plt.show()

```
:::

### **í™˜ê²½**

-   American airlinesì™€ US airwaysê°€ í˜„ì¬ í•©ë³‘ ì§„í–‰ì¤‘
-   ìƒìœ„ê¶Œì˜ ë‹¤ë¥¸ ëŒ€í˜• í•­ê³µì‚¬ë“¤ì´ 1ìœ„ ìë¦¬ë¥¼ ì§€í‚¤ë ¤ê³  í•¨
-   JetBlueëŠ” ì €ê°€ í•­ê³µ í¬ì§€ì…˜ì—ì„œ ëŒ€í˜• í•­ê³µì‚¬ì— ë§¤ê° í•˜ë ¤ í•¨

```{python}
#| fig-align: center

airlines_display = [
    "United Airlines (UA)",
    "Delta Air Lines (DL)",
    "American + US Airways (AA+US)",
    "Southwest Airlines (WN)",
    "JetBlue Airways (B6)",
    "Alaska Airlines (AS)",
    "ExpressJet (EV)",
    "Others (Others)"
]

rpm_values = [
    21.21, 20.52, (15.27 + 7.87), 10.73, 4.26, 3.11, 2.01, 15.02
]


carrier_codes_display = {
    "United Airlines (UA)": "UA",
    "Delta Air Lines (DL)": "DL",
    "American + US Airways (AA+US)": "AA+US",
    "Southwest Airlines (WN)": "WN",
    "JetBlue Airways (B6)": "B6",
    "Alaska Airlines (AS)": "AS",
    "ExpressJet (EV)": "EV",
    "Others (Others)": "Others"
}

custom_color_map = {
    'UA': '#a5d5c5',
    'DL': '#f08080',
    'AA+US': '#6fa9d2',
    'B6': '#000f5d',
    'EV': "#d1cce6",
    'US': '#c8e685',
    'WN': '#ccccff',
    'AS': '#8fbc8f',
    'Others': '#d3d3d3'
}

colors_custom = [custom_color_map.get(carrier_codes_display[label], '#d3d3d3') for label in airlines_display]
explode = [0.0 if "AA+US" not in label else 0.1 for label in airlines_display]

fig, ax = plt.subplots(figsize=(10, 8))
wedges, texts, autotexts = ax.pie(
    rpm_values,
    labels=airlines_display,
    autopct='%1.1f%%',
    startangle=140,
    colors=colors_custom,
    explode=explode,
    textprops={'fontsize': 11}
)

for i, label in enumerate(airlines_display):
    texts[i].set_fontweight('bold')
    texts[i].set_fontsize(13)
    autotexts[i].set_fontweight('bold')
    if "JetBlue" in label:
        autotexts[i].set_color("white")
        x, y = texts[i].get_position()
        texts[i].set_position((x, y - 0.07))
    if "AA+US" in label:
        wedges[i].set_edgecolor("red")
        wedges[i].set_linewidth(3)
    if "ExpressJet (EV)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x - 0.08, y + 0.20))   
    if "Alaska Airlines (AS)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x, y + 0.06)) 

# ëª¨ë“  í¼ì„¼íŠ¸ ìœ„ì¹˜ ê¸°ë³¸ê°’
for i, wedge in enumerate(wedges):
    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    # ê¸°ë³¸ê°’
    r = 0.70
    # EV/ASë§Œ ë” ë°”ê¹¥ìª½(0.85)ìœ¼ë¡œ
    if airlines_display[i] in ["ExpressJet (EV)"]:
        r = 0.87    # ë” ë°”ê¹¥: 0.9~0.95ê¹Œì§€ ê°€ëŠ¥ (ìˆ˜ì • ê°€ëŠ¥)
    elif airlines_display[i] in ["Alaska Airlines (AS)"]:
        r = 0.82
    x = r * np.cos(angle_rad)
    y = r * np.sin(angle_rad)
    autotexts[i].set_position((x, y))
    if airlines_display[i] not in ["ExpressJet (EV)", "Alaska Airlines (AS)"]:
        autotexts[i].set_fontsize(15)
    else:
        autotexts[i].set_fontsize(11)
    

def draw_arrow_label_to_wedge_edge_middle(ax, text_obj, wedge, arrow_color='gray', r=1.0, y_offset=-0.04):
    renderer = fig.canvas.get_renderer()
    bbox = text_obj.get_window_extent(renderer=renderer)
    x0_fig = (bbox.x0 + bbox.x1) / 2.03
    y0_fig = (bbox.y0 + bbox.y1) / 2
    inv = ax.transData.inverted()
    x0_data, y0_data = inv.transform((x0_fig, y0_fig))

    arrow_start_x = x0_data
    arrow_start_y = y0_data + y_offset

    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    x_wedge_edge = r * np.cos(angle_rad)
    y_wedge_edge = r * np.sin(angle_rad)

    ax.annotate(
        '', xy=(x_wedge_edge, y_wedge_edge), xytext=(arrow_start_x, arrow_start_y),
        arrowprops=dict(facecolor=arrow_color, arrowstyle='->', lw=2),
        annotation_clip=False
    )

fig.canvas.draw()

ev_idx = airlines_display.index("ExpressJet (EV)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[ev_idx], wedges[ev_idx], r=1.0, y_offset=-0.04)
as_idx = airlines_display.index("Alaska Airlines (AS)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[as_idx], wedges[as_idx], r=1.0, y_offset=-0.04)

plt.title("2013ë…„ ë¯¸êµ­ í•­ê³µì‚¬ RPM ì ìœ ìœ¨", fontsize=30, pad=-5, fontweight='bold')
plt.axis('equal')
plt.tight_layout()
plt.show()

```

### **ê¸°ëŒ€ ê²°ê³¼**

-   ëŒ€í˜• í•­ê³µì‚¬ì™€ì˜ í•©ë³‘ìœ¼ë¡œ ì ìœ ìœ¨ 1ìœ„ ë‹¬ì„±
-   ì €ê°€ í•­ê³µì‚¬ì¸ **Jetblue**ì˜ ì¥ì ê³¼ ëŒ€í˜• í•­ê³µì‚¬ì˜ ì¥ì ì„ í•©ì³ì„œ ì¢‹ì€ ì‹œë„ˆì§€ë¥¼ ê¸°ëŒ€í•¨

::::: columns
::: {.column width="50%"}
```{python}
airlines_display = [
    "United + JetBlue (UA+B6)",
    "Delta Air Lines (DL)",
    "American + US Airways (AA+US)",
    "Southwest Airlines (WN)",
    "Alaska Airlines (AS)",
    "ExpressJet (EV)",
    "Others (Others)"
]

rpm_values = [
    (21.21 + 4.26), 20.52, (15.27 + 7.87), 10.73, 3.11, 2.01, 15.02
]

carrier_codes_display = {
    "United + JetBlue (UA+B6)": "UA+B6",
    "Delta Air Lines (DL)": "DL",
    "American + US Airways (AA+US)": "AA+US",
    "Southwest Airlines (WN)": "WN",
    "Alaska Airlines (AS)": "AS",
    "ExpressJet (EV)": "EV",
    "Others (Others)": "Others"
}

custom_color_map = {
    'UA+B6': '#a5d5c5',
    'DL': '#f08080',
    'AA+US': '#6fa9d2',
    'B6': '#000f5d',
    'EV': "#d1cce6",
    'US': '#c8e685',
    'WN': '#ccccff',
    'AS': '#8fbc8f',
    'Others': '#d3d3d3'
}

colors_custom = [custom_color_map.get(carrier_codes_display[label], '#d3d3d3') for label in airlines_display]

# ê°•ì¡° ë° íŒŒì´ ë¹ ì ¸ë‚˜ì˜¤ëŠ” ë¶€ë¶„ UA+B6ë¡œ ë°”ê¿ˆ
explode = [0.1 if "United + JetBlue (UA+B6)" == label else 0.0 for label in airlines_display]

fig, ax = plt.subplots(figsize=(10, 8))
wedges, texts, autotexts = ax.pie(
    rpm_values,
    labels=airlines_display,
    autopct='%1.1f%%',
    startangle=140,
    colors=colors_custom,
    explode=explode,
    textprops={'fontsize': 11}
)

for i, label in enumerate(airlines_display):
    texts[i].set_fontweight('bold')
    texts[i].set_fontsize(13)
    autotexts[i].set_fontweight('bold')
    # JetBlue ìƒ‰ìƒ ê°•ì¡°ëŠ” ì´ë¯¸ UA+B6ë¡œ í•©ì³ì¡Œìœ¼ë‹ˆ ë³„ë„ ì²˜ë¦¬X
    if "JetBlue" in label:
        autotexts[i].set_color("black")
        x, y = texts[i].get_position()
        texts[i].set_position((x, y - 0.07))
    # ê°•ì¡° ëŒ€ìƒ UA+B6ë¡œ ë³€ê²½
    if "United + JetBlue (UA+B6)" == label:
        wedges[i].set_edgecolor("red")
        wedges[i].set_linewidth(3)
    if "ExpressJet (EV)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x - 0.08, y + 0.20))   
    if "Alaska Airlines (AS)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x, y + 0.06)) 

# í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì¡°ì •
for i, wedge in enumerate(wedges):
    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    r = 0.70
    if airlines_display[i] == "ExpressJet (EV)":
        r = 0.87
    elif airlines_display[i] == "Alaska Airlines (AS)":
        r = 0.82
    x = r * np.cos(angle_rad)
    y = r * np.sin(angle_rad)
    autotexts[i].set_position((x, y))
    if airlines_display[i] not in ["ExpressJet (EV)", "Alaska Airlines (AS)"]:
        autotexts[i].set_fontsize(15)
    else:
        autotexts[i].set_fontsize(11)

def draw_arrow_label_to_wedge_edge_middle(ax, text_obj, wedge, arrow_color='gray', r=1.0, y_offset=-0.04):
    renderer = fig.canvas.get_renderer()
    bbox = text_obj.get_window_extent(renderer=renderer)
    x0_fig = (bbox.x0 + bbox.x1) / 2.03
    y0_fig = (bbox.y0 + bbox.y1) / 2
    inv = ax.transData.inverted()
    x0_data, y0_data = inv.transform((x0_fig, y0_fig))

    arrow_start_x = x0_data
    arrow_start_y = y0_data + y_offset

    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    x_wedge_edge = r * np.cos(angle_rad)
    y_wedge_edge = r * np.sin(angle_rad)

    ax.annotate(
        '', xy=(x_wedge_edge, y_wedge_edge), xytext=(arrow_start_x, arrow_start_y),
        arrowprops=dict(facecolor=arrow_color, arrowstyle='->', lw=2),
        annotation_clip=False
    )

fig.canvas.draw()

ev_idx = airlines_display.index("ExpressJet (EV)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[ev_idx], wedges[ev_idx], r=1.0, y_offset=-0.04)
as_idx = airlines_display.index("Alaska Airlines (AS)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[as_idx], wedges[as_idx], r=1.0, y_offset=-0.04)

plt.title("2013ë…„ ë¯¸êµ­ í•­ê³µì‚¬ RPM ì ìœ ìœ¨", 
          fontsize=30, pad=-5, fontweight='bold')
plt.axis('equal')
plt.tight_layout()
plt.show()
```
:::

::: {.column width="50%"}
```{python}

airlines_display = [
    "United Airlines (UA)",
    "Delta + JetBlue Air Lines (DL+B6)",
    "American + US Airways (AA+US)",
    "Southwest Airlines (WN)",
    "Alaska Airlines (AS)",
    "ExpressJet (EV)",
    "Others (Others)"
]

rpm_values = [
    21.21, (20.52 + 4.26), (15.27 + 7.87), 10.73, 3.11, 2.01, 15.02
]

carrier_codes_display = {
    "United Airlines (UA)": "UA",
    "Delta + JetBlue Air Lines (DL+B6)": "DL+B6",
    "American + US Airways (AA+US)": "AA+US",
    "Southwest Airlines (WN)": "WN",
    "Alaska Airlines (AS)": "AS",
    "ExpressJet (EV)": "EV",
    "Others (Others)": "Others"
}

custom_color_map = {
    'UA': '#a5d5c5',
    'DL+B6': '#f08080',  # ë¸íƒ€+ì ¯ë¸”ë£¨ ê°•ì¡° ì»¬ëŸ¬(ë¸íƒ€ ê¸°ì¤€)
    'AA+US': '#6fa9d2',
    'B6': '#000f5d',
    'EV': "#d1cce6",
    'US': '#c8e685',
    'WN': '#ccccff',
    'AS': '#8fbc8f',
    'Others': '#d3d3d3'
}

colors_custom = [custom_color_map.get(carrier_codes_display[label], '#d3d3d3') for label in airlines_display]

# DL+B6 ê°•ì¡°, explode ì„¤ì •
explode = [0.1 if label == "Delta + JetBlue Air Lines (DL+B6)" else 0.0 for label in airlines_display]

fig, ax = plt.subplots(figsize=(10, 8))
wedges, texts, autotexts = ax.pie(
    rpm_values,
    labels=airlines_display,
    autopct='%1.1f%%',
    startangle=140,
    colors=colors_custom,
    explode=explode,
    textprops={'fontsize': 11}
)

for i, label in enumerate(airlines_display):
    texts[i].set_fontweight('bold')
    texts[i].set_fontsize(13)
    autotexts[i].set_fontweight('bold')
    if "JetBlue" in label:
        autotexts[i].set_color("white")
        x, y = texts[i].get_position()
        texts[i].set_position((x, y - 0.07))
    # DL+B6ë§Œ ê°•ì¡°(í…Œë‘ë¦¬, ë‘ê»˜)
    if label == "Delta + JetBlue Air Lines (DL+B6)":
        wedges[i].set_edgecolor("red")
        wedges[i].set_linewidth(3)
        x, y = texts[i].get_position()
        texts[i].set_position((x + 0.23, y))
    if label == "ExpressJet (EV)":
        x, y = texts[i].get_position()
        texts[i].set_position((x - 0.08, y + 0.20))
    if label == "Alaska Airlines (AS)":
        x, y = texts[i].get_position()
        texts[i].set_position((x, y + 0.06))

for i, wedge in enumerate(wedges):
    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    r = 0.70
    if airlines_display[i] == "ExpressJet (EV)":
        r = 0.87
    elif airlines_display[i] == "Alaska Airlines (AS)":
        r = 0.82
    x = r * np.cos(angle_rad)
    y = r * np.sin(angle_rad)
    autotexts[i].set_position((x, y))
    if airlines_display[i] not in ["ExpressJet (EV)", "Alaska Airlines (AS)"]:
        autotexts[i].set_fontsize(15)
    else:
        autotexts[i].set_fontsize(11)

def draw_arrow_label_to_wedge_edge_middle(ax, text_obj, wedge, arrow_color='gray', r=1.0, y_offset=-0.04):
    renderer = fig.canvas.get_renderer()
    bbox = text_obj.get_window_extent(renderer=renderer)
    x0_fig = (bbox.x0 + bbox.x1) / 2.03
    y0_fig = (bbox.y0 + bbox.y1) / 2
    inv = ax.transData.inverted()
    x0_data, y0_data = inv.transform((x0_fig, y0_fig))

    arrow_start_x = x0_data
    arrow_start_y = y0_data + y_offset

    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    x_wedge_edge = r * np.cos(angle_rad)
    y_wedge_edge = r * np.sin(angle_rad)

    ax.annotate(
        '', xy=(x_wedge_edge, y_wedge_edge), xytext=(arrow_start_x, arrow_start_y),
        arrowprops=dict(facecolor=arrow_color, arrowstyle='->', lw=2),
        annotation_clip=False
    )

fig.canvas.draw()

ev_idx = airlines_display.index("ExpressJet (EV)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[ev_idx], wedges[ev_idx], r=1.0, y_offset=-0.04)
as_idx = airlines_display.index("Alaska Airlines (AS)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[as_idx], wedges[as_idx], r=1.0, y_offset=-0.04)

plt.title("2013ë…„ ë¯¸êµ­ í•­ê³µì‚¬ RPM ì ìœ ìœ¨", fontsize=30, pad=70, fontweight='bold')

plt.axis('equal')
plt.tight_layout()
plt.show()
```
:::
:::::

## ë°ì´í„° ì„¤ëª…

-   nycflights13 ë°ì´í„° í™œìš© - 2013ë…„ë„ì˜ ë‰´ìš•ì‹œ í•­ê³µ ë°ì´í„°

| í…Œì´ë¸”      | ì„¤ëª…                                                 |
|-------------|------------------------------------------------------|
| airlines    | í•­ê³µì‚¬ ì´ë¦„ ì •ë³´                                     |
| airports    | ê³µí•­ ë©”íƒ€ë°ì´í„° (ê³µí•­ ìœ„ì¹˜, ì´ë¦„, ì½”ë“œ ë“±)           |
| **flights** | í•­ê³µí¸ ë°ì´í„° (ì¶œë°œ/ë„ì°© ì‹œê°„, ì§€ì—°, í•­ê³µí¸ ì •ë³´ ë“±) |
| **planes**  | í•­ê³µê¸° ë©”íƒ€ë°ì´í„° (ê¸°ì²´ ë²ˆí˜¸, ì œì¡°ì‚¬, ëª¨ë¸ ë“±)       |
| weather     | ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ ë°ì´í„° (ê¸°ì˜¨, í’ì†, ì‹œì • ë“±)           |

## ë°ì´í„° ì „ì²˜ë¦¬

### ë°ì´í„° ë¡œë“œ

```{python}

import pandas as pd
import numpy as np
import nycflights13 as flights  # flights13 ë°ì´í„° íŒ¨í‚¤ì§€
import re  # ì •ê·œ í‘œí˜„ì‹(Regular Expression)ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
import seaborn as sns  # ì‹œê°í™”ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€
import matplotlib.pyplot as plt

# í°íŠ¸ì„¤ì •
plt.rc('font', family='Malgun Gothic')
plt.rc('axes', unicode_minus=False)

# print("=== 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ===\n")
df_flights = flights.flights.copy()  # flights í…Œì´ë¸” ì›ë³¸ë°ì´í„°
df_planes = flights.planes.copy()  # planes í…Œì´ë¸” ì›ë³¸ë°ì´í„°

print(f"flights ë°ì´í„°: {df_flights.shape}")
print(f"planes ë°ì´í„°: {df_planes.shape}")
df_flights.info()
```

### Flights ê²°ì¸¡ì¹˜ í™•ì¸

::::: columns
::: {.column width="40%"}
```{python}
# flights ê²°ì¸¡ì¹˜ ì»¬ëŸ¼
flights_mv = df_flights.isnull().sum()
flights_mv[flights_mv > 0]
```
:::

::: {.column width="60%"}
```{python}
plt.figure(figsize=(30, 18))
sns.heatmap(df_flights.isnull(), cbar=False, cmap='cividis', yticklabels=False)
plt.title("ê²°ì¸¡ì¹˜ íˆíŠ¸ë§µ", fontsize=100, fontdict={'fontweight':'bold'}, pad=10)
plt.xticks(fontsize=50, rotation = 90)
plt.show()
```
:::
:::::

### ì‹œê°„ ë°ì´í„° ê²°ì¸¡ì¹˜ ì²˜ë¦¬

```{python}
# ë°ì´í„° ê²°ì¸¡ì¹˜ ì²˜ë¦¬
# 2. flights í…Œì´ë¸”ì˜ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ (ëª¨ë‘ ê²°ì¸¡ì´ë©´ 0ìœ¼ë¡œ ì±„ìš°ê¸°)
# print("\n=== 2. flights ì‹œê°„ ë°ì´í„° ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ===\n")
time_delay_cols = ['dep_time', 'arr_time', 'dep_delay', 'arr_delay', 'air_time']

# print("ì²˜ë¦¬ ì „ ê²°ì¸¡ì¹˜ ìˆ˜:")
for col in time_delay_cols:
    print(f"{col}: {df_flights[col].isna().sum()}")

# ëª¨ë“  ì»¬ëŸ¼ì´ ê²°ì¸¡ì¸ í–‰ ì°¾ê¸°
all_missing_mask = df_flights[time_delay_cols].isna().all(axis=1)
print(f"\nëª¨ë“  ì‹œê°„/ì§€ì—° ì»¬ëŸ¼ì´ ê²°ì¸¡ì¸ í–‰ì˜ ìˆ˜: {all_missing_mask.sum()}")
print(" --> ì´ ê²½ìš° ê²°í•­ìœ¼ë¡œ ê°€ì •")

# ëª¨ë“  ì»¬ëŸ¼ì´ ê²°ì¸¡ì¸ í–‰ë§Œ 0ìœ¼ë¡œ ì±„ìš°ê¸° --> ê²°í•­ëœ ê²½ìš°ë¡œ ìƒê°
df_flights.loc[all_missing_mask, time_delay_cols] = 0
# ëª¨ë“  ì»¬ëŸ¼ì´ ê²°ì¸¡ì¸ í–‰ë§Œ 0ìœ¼ë¡œ ì±„ìš°ê¸° --> ê²°í•­ëœ ê²½ìš°ë¡œ ìƒê°
df_flights.loc[all_missing_mask, "is_canceled"] = True
df_flights.loc[~all_missing_mask, "is_canceled"] = False

# print("\nì²˜ë¦¬ í›„ ê²°ì¸¡ì¹˜ ìˆ˜:")
for col in time_delay_cols:
    print(f"{col}: {df_flights[col].isna().sum()}")
    
# print("\nê²°í•­ ì—¬ë¶€ :")
```

### í•­ê³µí¸ ì·¨ì†Œ ì—¬ë¶€ ë¶„í¬

```{python}
# ì¹´ìš´íŠ¸ ì‹œê°í™”
#| fig-align: "center"
plt.rc('font', family='Malgun Gothic')
plt.rc('axes', unicode_minus=False)

plt.figure(figsize=(6, 5))
sns.countplot(x='is_canceled', data=df_flights, palette='pastel')

# ê·¸ë˜í”„ ì œëª© ë° ë¼ë²¨
plt.title('í•­ê³µí¸ ì·¨ì†Œ ì—¬ë¶€ ë¶„í¬', fontsize=16, fontweight='bold')
plt.xlabel('ì·¨ì†Œ ì—¬ë¶€', fontsize=12)
plt.ylabel('í•­ê³µí¸ ìˆ˜', fontsize=12)
plt.xticks([0, 1], ['ìš´í•­ë¨', 'ì·¨ì†Œë¨'])

# ìˆ˜ì¹˜ ë¼ë²¨ í‘œì‹œ (ì„ íƒ)
for p in plt.gca().patches:
    count = int(p.get_height())
    plt.gca().annotate(f'{count:,}', (p.get_x() + p.get_width() / 2, p.get_height()), 
                       ha='center', va='bottom', fontsize=11)

plt.tight_layout()
plt.show()
```

### ì‹œê°„ ë°ì´í„° ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í›„ ê²°ì¸¡ì¹˜ íˆíŠ¸ë§µ

```{python}
plt.figure(figsize=(10, 6))
sns.heatmap(df_flights.isnull(), cbar=False, cmap='cividis', yticklabels=False)
plt.title("ê²°ì¸¡ì¹˜ íˆíŠ¸ë§µ", fontsize=20, fontdict={'fontweight':'bold'}, pad=15)
plt.xticks(fontsize=12)
plt.show()
```

### tailnum, model ê²°ì¸¡ì¹˜ í™•ì¸

-   flights í…Œì´ë¸”ê³¼ planes í…Œì´ë¸”ì„ ë³‘í•©
-   ì´í›„ tailnumê³¼ model ê²°ì¸¡ì¹˜ ë¹„ìœ¨ í™•ì¸

```{python}
#| fig-align: center
# ë³‘í•©
df_merge = pd.merge(df_flights, df_planes, on='tailnum', how='left', suffixes=('', '_plane'))

# ì „ì²´ tailnum, model ê²°ì¸¡ì¹˜ ê°œìˆ˜ì™€ ë¹„ìœ¨
total_rows = df_merge.shape[0]
missing_tailnum_count = df_merge['tailnum'].isna().sum()
missing_tailnum_ratio = missing_tailnum_count / total_rows * 100

missing_model_count = df_merge['model'].isna().sum()
missing_model_ratio = missing_model_count / total_rows * 100

print(f"ì´ í–‰ ê°œìˆ˜: {total_rows}")
print(f"tailnum ê²°ì¸¡ì¹˜ ê°œìˆ˜: {missing_tailnum_count} ({missing_tailnum_ratio:.2f}%)")
print(f"model ê²°ì¸¡ì¹˜ ê°œìˆ˜: {missing_model_count} ({missing_model_ratio:.2f}%)")

# ì‹œê°í™” ë°ì´í„° ì¤€ë¹„
labels = ['ì¡´ì¬í•¨', 'ê²°ì¸¡ì¹˜']
tailnum_values = [total_rows - missing_tailnum_count, missing_tailnum_count]
model_values = [total_rows - missing_model_count, missing_model_count]

# íŒŒì´ì°¨íŠ¸ ê·¸ë¦¬ê¸°
fig, axs = plt.subplots(1, 2, figsize=(10, 5))

# tailnum íŒŒì´ì°¨íŠ¸
axs[0].pie(tailnum_values, labels=labels, autopct='%1.1f%%', startangle=90,
           colors=['#90ee90', '#ff9999'], wedgeprops={'edgecolor': 'white'})
axs[0].set_title('tailnum ê²°ì¸¡ ë¹„ìœ¨')

# model íŒŒì´ì°¨íŠ¸
axs[1].pie(model_values, labels=labels, autopct='%1.1f%%', startangle=90,
           colors=['#add8e6', '#ff9999'], wedgeprops={'edgecolor': 'white'})
axs[1].set_title('model ê²°ì¸¡ ë¹„ìœ¨')

plt.suptitle('ê²°ì¸¡ì¹˜ ë¹„ìœ¨ (tailnum vs. model)', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.show()
```

### ê²°ì¸¡ê°’ ì±„ìš°ê¸° ì „ëµ

-   ê¸°ì¢… ê¸°ë°˜ ì •ë°€ ë¶„ì„(ì§€ì—°ë¥ , ê¸°ì²´ ì„±ëŠ¥ ë“±) â†’ dropna ì²˜ë¦¬

-   ìš´í•­ëŸ‰ ì—°ê´€, ì „ì²´ ë°ì´í„° íë¦„ ì¤‘ìš” â†’'Unknown'ìœ¼ë¡œ ì±„ì›€

```{python}
#| fig-align: center
# ë³µì‚¬
new_df = df_merge.copy()

# ì²˜ë¦¬ ì „ í†µê³„
total_before = len(new_df)
missing_model = new_df['model'].isna().sum()
missing_year = new_df['year_plane'].isna().sum()  # year ì»¬ëŸ¼ëª… í™•ì¸ í•„ìš”

# ì „ëµ 1: dropna ë‘˜ ë‹¤ ê²°ì¸¡ì¹˜ ì œê±°
df_drop = new_df.dropna(subset=['model', 'year_plane'])
total_drop = len(df_drop)

# ì „ëµ 2: fillna
df_fill = new_df.copy()
df_fill['model'] = df_fill['model'].fillna('Unknown')
df_fill['year_plane'] = df_fill['year_plane'].fillna(
    df_fill.groupby('tailnum')['year_plane'].transform('mean')
).round().astype('Int64')
df_fill['year_plane'] = df_fill['year_plane'].fillna(-1)

# ê°’ ê³„ì‚°
total_fill = len(df_fill)
unknown_model = (df_fill['model'] == 'Unknown').sum()
minus1_year = (df_fill['year_plane'] == -1).sum()

# ì‹œê°í™” ì¤€ë¹„
labels = ['ì „ì²´ í–‰ ìˆ˜', "'Unknown' model ìˆ˜", "'-1' year ìˆ˜"]
values = [total_fill, unknown_model, minus1_year]
colors = ['#86bf91', '#f4b183', '#9dc3e6']

# ì‹œê°í™”
plt.figure(figsize=(8, 5))
barplot = sns.barplot(x=labels, y=values, palette=colors)

# ë§‰ëŒ€ ìœ„ ìˆ«ì í‘œì‹œ
for i, val in enumerate(values):
    barplot.text(i, val + total_fill * 0.015, f"{val:,}", ha='center', va='bottom', fontsize=11)

plt.title("fillna ì ìš© í›„ ê²°ê³¼ ìš”ì•½", fontsize=14)
plt.ylabel("ê±´ìˆ˜")
plt.ylim(0, total_fill * 1.15)
plt.tight_layout()
plt.show()
```

### ë°ì´í„° ì„ íƒ

ìµœì¢… ì„ íƒëœ ì»¬ëŸ¼

| êµ¬ë¶„ | í¬í•¨ ì»¬ëŸ¼ |
|------------------------------------|------------------------------------|
| ë‚ ì§œ/ì‹œê°„ ì •ë³´ | `year`, `month`, `day`, `hour`, `dep_time`, `sched_dep_time`, `arr_time`, `sched_arr_time` |
| ì§€ì—° ì •ë³´ | `dep_delay`, `arr_delay` |
| í•­ê³µí¸ ì •ë³´ | `carrier`, `flight`, `origin`, `dest` |
| í•­ê³µê¸° ì •ë³´ | `tailnum`, `year_plane`, `model` |

## ë°ì´í„° ë¶„ì„
ë§¤ê° ëª…ë¶„ í™•ì¸ ë° íƒ€ë‹¹ì„± ê²€í† 

### í•­ê³µê¸°ì²´ ì œì‘ë…„ë„ ë¶„í¬

```{python}
#| fig-align: "center"
import pandas as pd
import matplotlib.pyplot as plt

# ===== 1. CSV ë¶ˆëŸ¬ì˜¤ê¸° =====
df = pd.read_csv("./data/df_drop.csv")

# # ===== 2. í•œêµ­ì–´ í°íŠ¸ ì„¤ì • =====
# plt.rcParams['font.family'] = 'Malgun Gothic'
# plt.rcParams['axes.unicode_minus'] = False

# ===== 3. ëŒ€ìƒ í•­ê³µì‚¬ í•„í„°ë§ =====
target_carriers = ['DL', 'UA', 'B6']
df_target = df[df['carrier'].isin(target_carriers)].copy()

# ì œì‘ë…„ë„ ê²°ì¸¡ì¹˜ ì œê±°
df_target = df_target.dropna(subset=['year_plane'])

# ===== 4. ëª¨ë¸ë³„ ê°œìˆ˜ ê³„ì‚° í›„ ìƒìœ„ Nê°œ ëª¨ë¸ë§Œ í‘œì‹œ =====
N = 15
top_models = df_target['model'].value_counts().head(N).index
df_filtered = df_target[df_target['model'].isin(top_models)]

# ===== 5. ì‚°ì ë„ ê¸°ë³¸ ì‹œê°í™” =====
plt.figure(figsize=(20,15))

# ìš”ì²­í•œ ìƒ‰ìƒ ì½”ë“œ ì ìš©
colors = {'DL': '#f08080',  # ì—°í•œ ë¹¨ê°•
          'UA': '#a5d5c5',  # ì—°í•œ ë¯¼íŠ¸
          'B6': '#000f5d'}  # ì§„í•œ ë„¤ì´ë¹„

for carrier in target_carriers:
    subset = df_filtered[df_filtered['carrier'] == carrier]
    plt.scatter(subset['year_plane'], subset['model'],
                alpha=0.5, s=200, c=colors[carrier], label=carrier)

# ===== 6. ë¸íƒ€í•­ê³µ ì œì‘ë…„ë„ ë‚®ì€ ë¶€ë¶„ ê°•ì¡° =====
plt.axvspan(1980, 1995, color='blue', alpha=0.1, label='ë¸íƒ€ ì˜¤ë˜ëœ ì œì‘ë…„ë„ êµ¬ê°„')

# ===== 7. yì¶• A320-232 ë¼ì¸ ê°•ì¡° =====
ax = plt.gca()
yticks = ax.get_yticks()
yticklabels = [label.get_text() for label in ax.get_yticklabels()]
if 'A320-232' in yticklabels:
    index = yticklabels.index('A320-232')
    y_value = yticks[index]
    plt.axhspan(y_value-0.3, y_value+0.3, color='red', alpha=0.1)

# ===== 8. yì¶• ë¼ë²¨ ê°•ì¡° =====
for label in ax.get_yticklabels():
    if label.get_text() == 'A320-232':
        label.set_color('red')
        label.set_fontweight('bold')

# ===== 9. ì¶• ê¸€ì”¨ í¬ê¸° ë° ë²”ë¡€, íƒ€ì´í‹€ í¬ê¸° ì¡°ì • =====
plt.xticks(fontsize=16)
plt.yticks(fontsize=16)
plt.xlabel("ì œì‘ë…„ë„ (year_plane)", fontsize=20)
plt.ylabel("ê¸°ì¢… (model)", fontsize=20)
plt.title(f"ë¸íƒ€ / ìœ ë‚˜ì´í‹°ë“œ / ì ¯ë¸”ë£¨ í•­ê³µ ê¸°ì²´ ì œì‘ë…„ë„ ë¶„í¬ (ìƒìœ„ {N} ëª¨ë¸) - A320-232 ê°•ì¡°",
          fontsize=24, fontweight='bold')

plt.legend(title="í•­ê³µì‚¬ / ê°•ì¡°êµ¬ê°„", title_fontsize=18, fontsize=16)

plt.tight_layout()
plt.show()
```

### ì ¯ë¸”ë£¨(B6) í•­ê³µì‚¬ì™€ ì‚¬ìš°ìŠ¤ì›¨ìŠ¤íŠ¸(WN) í•­ê³µì‚¬ì˜ ì‹œê°„ëŒ€ë³„ í‰ê·  ì§€ì—°ì‹œê°„ ë¹„êµ

```{python}
#ì‚¬ìš©ëœ ì»¬ëŸ¼: ['carrier', 'hour', 'dep_delay']

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv('./data/df_drop.csv')

# B6, WN ë°ì´í„°ë§Œ ì¶”ì¶œ
b6_wn = df[df['carrier'].isin(['B6', 'WN'])].copy()

# ì‹œê°„ëŒ€ë³„ í‰ê·  ì§€ì—° ê³„ì‚°
b6_delay = b6_wn[b6_wn['carrier'] == 'B6'].groupby('hour')['dep_delay'].mean().reset_index()
b6_delay.rename(columns={'dep_delay': 'b6_delay'}, inplace=True)
wn_delay = b6_wn[b6_wn['carrier'] == 'WN'].groupby('hour')['dep_delay'].mean().reset_index()
wn_delay.rename(columns={'dep_delay': 'wn_delay'}, inplace=True)
b6wn_result = pd.merge(b6_delay, wn_delay, on='hour', how='outer').sort_values('hour')
b6wn_plot = b6wn_result[(b6wn_result['hour'] >= 5) & (b6wn_result['hour'] <= 23)]

# ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
plt.figure(figsize=(12, 8))
plt.plot(b6wn_plot['hour'], b6wn_plot['wn_delay'], marker='o', color='#999999', linewidth=2, label='ì‚¬ìš°ìŠ¤ì›¨ìŠ¤íŠ¸(WN)')
plt.plot(b6wn_plot['hour'], b6wn_plot['b6_delay'], marker='o', color='#000f5d', linewidth=4, alpha=0.9, label='ì ¯ë¸”ë£¨(B6)')

plt.xticks(b6wn_plot['hour'], fontsize=16)
plt.xlabel('ì¶œë°œ ì‹œê° (ì‹œ)', fontsize=20, labelpad=20)
plt.ylabel('í‰ê·  ì§€ì—°ì‹œê°„ (ë¶„)', fontsize=20, labelpad=25)
plt.title(
    'ì ¯ë¸”ë£¨(B6) í•­ê³µì‚¬ì™€ ì‚¬ìš°ìŠ¤ì›¨ìŠ¤íŠ¸(WN) í•­ê³µì‚¬ì˜ ì‹œê°„ëŒ€ë³„ í‰ê·  ì§€ì—°ì‹œê°„ ë¹„êµ', 
    fontsize=23, 
    pad=5,
    fontweight="bold" # ì œëª©ì„ ìœ„ìª½ ì¤‘ì•™ì— ì •ë ¬
)

plt.legend(fontsize=17, loc='upper left')
plt.grid(True, axis='x', linestyle=':')
plt.tight_layout()
plt.show()

```

## ê²°ê³¼

```{python}
#| fig-align: "center"
import pandas as pd
import matplotlib.pyplot as plt
import platform
import numpy as np

airlines_display = [
    "United + JetBlue (UA+B6)",
    "Delta Air Lines (DL)",
    "American + US Airways (AA+US)",
    "Southwest Airlines (WN)",
    "Alaska Airlines (AS)",
    "ExpressJet (EV)",
    "Others (Others)"
]

rpm_values = [
    (21.21 + 4.26), 20.52, (15.27 + 7.87), 10.73, 3.11, 2.01, 15.02
]

carrier_codes_display = {
    "United + JetBlue (UA+B6)": "UA+B6",
    "Delta Air Lines (DL)": "DL",
    "American + US Airways (AA+US)": "AA+US",
    "Southwest Airlines (WN)": "WN",
    "Alaska Airlines (AS)": "AS",
    "ExpressJet (EV)": "EV",
    "Others (Others)": "Others"
}

custom_color_map = {
    'UA+B6': '#a5d5c5',
    'DL': '#f08080',
    'AA+US': '#6fa9d2',
    'B6': '#000f5d',
    'EV': "#d1cce6",
    'US': '#c8e685',
    'WN': '#ccccff',
    'AS': '#8fbc8f',
    'Others': '#d3d3d3'
}

colors_custom = [custom_color_map.get(carrier_codes_display[label], '#d3d3d3') for label in airlines_display]

# ê°•ì¡° ë° íŒŒì´ ë¹ ì ¸ë‚˜ì˜¤ëŠ” ë¶€ë¶„ UA+B6ë¡œ ë°”ê¿ˆ
explode = [0.1 if "United + JetBlue (UA+B6)" == label else 0.0 for label in airlines_display]

fig, ax = plt.subplots(figsize=(10, 8))
wedges, texts, autotexts = ax.pie(
    rpm_values,
    labels=airlines_display,
    autopct='%1.1f%%',
    startangle=140,
    colors=colors_custom,
    explode=explode,
    textprops={'fontsize': 11}
)

for i, label in enumerate(airlines_display):
    texts[i].set_fontweight('bold')
    texts[i].set_fontsize(13)
    autotexts[i].set_fontweight('bold')
    # JetBlue ìƒ‰ìƒ ê°•ì¡°ëŠ” ì´ë¯¸ UA+B6ë¡œ í•©ì³ì¡Œìœ¼ë‹ˆ ë³„ë„ ì²˜ë¦¬X
    if "JetBlue" in label:
        autotexts[i].set_color("black")
        x, y = texts[i].get_position()
        texts[i].set_position((x, y - 0.07))
    # ê°•ì¡° ëŒ€ìƒ UA+B6ë¡œ ë³€ê²½
    if "United + JetBlue (UA+B6)" == label:
        wedges[i].set_edgecolor("red")
        wedges[i].set_linewidth(3)
    if "ExpressJet (EV)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x - 0.08, y + 0.20))   
    if "Alaska Airlines (AS)" == label:
        x, y = texts[i].get_position()
        texts[i].set_position((x, y + 0.06)) 

# í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì¡°ì •
for i, wedge in enumerate(wedges):
    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    r = 0.70
    if airlines_display[i] == "ExpressJet (EV)":
        r = 0.87
    elif airlines_display[i] == "Alaska Airlines (AS)":
        r = 0.82
    x = r * np.cos(angle_rad)
    y = r * np.sin(angle_rad)
    autotexts[i].set_position((x, y))
    if airlines_display[i] not in ["ExpressJet (EV)", "Alaska Airlines (AS)"]:
        autotexts[i].set_fontsize(15)
    else:
        autotexts[i].set_fontsize(11)

def draw_arrow_label_to_wedge_edge_middle(ax, text_obj, wedge, arrow_color='gray', r=1.0, y_offset=-0.04):
    renderer = fig.canvas.get_renderer()
    bbox = text_obj.get_window_extent(renderer=renderer)
    x0_fig = (bbox.x0 + bbox.x1) / 2.03
    y0_fig = (bbox.y0 + bbox.y1) / 2
    inv = ax.transData.inverted()
    x0_data, y0_data = inv.transform((x0_fig, y0_fig))

    arrow_start_x = x0_data
    arrow_start_y = y0_data + y_offset

    theta = (wedge.theta1 + wedge.theta2) / 2
    angle_rad = np.deg2rad(theta)
    x_wedge_edge = r * np.cos(angle_rad)
    y_wedge_edge = r * np.sin(angle_rad)

    ax.annotate(
        '', xy=(x_wedge_edge, y_wedge_edge), xytext=(arrow_start_x, arrow_start_y),
        arrowprops=dict(facecolor=arrow_color, arrowstyle='->', lw=2),
        annotation_clip=False
    )

fig.canvas.draw()

ev_idx = airlines_display.index("ExpressJet (EV)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[ev_idx], wedges[ev_idx], r=1.0, y_offset=-0.04)
as_idx = airlines_display.index("Alaska Airlines (AS)")
draw_arrow_label_to_wedge_edge_middle(ax, texts[as_idx], wedges[as_idx], r=1.0, y_offset=-0.04)

plt.title("2013ë…„ ë¯¸êµ­ í•­ê³µì‚¬ RPM ì ìœ ìœ¨", 
          fontsize=18, pad=-5, fontweight='bold')
plt.axis('equal')
plt.tight_layout()
plt.show()
```

### 

```{python}
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# ===== 1. ë°ì´í„° (ì‹œë®¬ë ˆì´ì…˜) =====
years_aa = np.array([2011, 2012, 2013, 2014, 2015, 2016])
aa_us_base = np.array([5.0, 6.0, 8.5, 11.0, 12.5, 14.0])

df_aa_real = pd.DataFrame({
    'Year': years_aa,
    'Type': ['AA + US Airways (ì‹¤ì œ)'] * len(years_aa),
    'MarketCap (Billion)': aa_us_base
})

years_ua_jetblue_aa = np.array([2013, 2014, 2015, 2016, 2017, 2018])
ua_jetblue_aa_trend = np.array([15.4, 17.0, 18.5, 20.0, 21.0, 22.5])

df_ua_jetblue_aa = pd.DataFrame({
    'Year': years_ua_jetblue_aa,
    'Type': ['UA+JetBlue (AA+US Trend)'] * len(years_ua_jetblue_aa),
    'MarketCap (Billion)': ua_jetblue_aa_trend
})

df_simulated = pd.concat([df_aa_real, df_ua_jetblue_aa])

# ===== 2. Market.csv ë¡œë“œ =====
df_market = pd.read_csv("./data/Market.csv")

# ===== 3. í•œêµ­ì–´ ë³€í™˜ ë§¤í•‘ =====
korean_map = {
    "United Airlines (UA)": "ìœ ë‚˜ì´í‹°ë“œ í•­ê³µ",
    "Delta Air Lines (DL)": "ë¸íƒ€ í•­ê³µ",
    "American + US Airways (AA+US)": "ì•„ë©”ë¦¬ì¹¸+US í•­ê³µ",
    "Southwest Airlines (WN)": "ì‚¬ìš°ìŠ¤ì›¨ìŠ¤íŠ¸ í•­ê³µ",
    "JetBlue Airways (B6)": "ì ¯ë¸”ë£¨ í•­ê³µ",
    "Alaska Airlines (AS)": "ì•Œë˜ìŠ¤ì¹´ í•­ê³µ",
    "ExpressJet Airlines (EV)": "ìµìŠ¤í”„ë ˆìŠ¤ì ¯ í•­ê³µ",
    "Others (Others)": "ê¸°íƒ€",
    "AA + US Airways (ì‹¤ì œ)": "AA+US ì‹¤ì œ",
    "UA+JetBlue (AA+US Trend)": "UA+ì ¯ë¸”ë£¨ (AA+US ì¶”ì„¸)"
}

# ===== 4. ì‹œê°í™” =====
usd_to_eur = 0.9
fig, ax1 = plt.subplots(figsize=(12, 7))

# Market ë°ì´í„° (ì‹¤ì„ )
for t in df_market['Type'].unique():
    subset = df_market[df_market['Type'] == t]
    ax1.plot(
        subset['Year'],
        subset['MarketCap (Billion)'],
        marker='o',
        linewidth=2,
        label=f"[ì‹œì¥] {korean_map.get(t, t)}"
    )

# ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° (ì ì„ )
for t in df_simulated['Type'].unique():
    subset = df_simulated[df_simulated['Type'] == t]
    ax1.plot(
        subset['Year'],
        subset['MarketCap (Billion)'],
        marker='o',
        linestyle='--',
        linewidth=2,
        label=f"[ì‹œë®¬ë ˆì´ì…˜] {korean_map.get(t, t)}"
    )

# ì™¼ìª½ yì¶• (USD)
ax1.set_xlabel("ì—°ë„", fontsize=14)
ax1.set_ylabel("ì‹œê°€ì´ì•¡ (ì‹­ì–µ ë‹¬ëŸ¬)", fontsize=14)
ax1.tick_params(axis='y', labelcolor='black')
ax1.grid(True, alpha=0.3)

# ì œëª©
fig.suptitle("í•­ê³µì‚¬ ì‹œê°€ì´ì•¡ ë¹„êµ (USD vs EUR)", fontsize=20, fontweight='bold', y=1.03)

# ë²”ë¡€ (ì™¼ìª½ ìœ„)
ax1.legend(loc='upper left', fontsize=12)

plt.tight_layout()
plt.show()
```

### Q & A {.middle style="text-align: center; font-size: 2em;"}
```{python}
#| echo: true
#| eval: true
#| output: false
```